% utility.tex
% Copyright (C) 2018 Kelly Smith.
%
% This work may be distributed and/or modified under the
% conditions of the LaTeX Project Public License (LPPL),
% either version 1.3c of this license or (at your option)
% any later version. The latest version of this license
% is in the file:
%
%   http://www.latex-project.org/lppl.txt
%
% This work has the LPPL maintenance status `maintained'.
% 
% The Current Maintainer of this work is Kelly Smith.
%
% This work consists of the files listed in the README.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Scratch Variables
%

\tl_new:N \l_soranus_tmpa_tl
\tl_new:N \l_soranus_tmpb_tl

\str_new:N \l_soranus_tmpa_str
\str_new:N \l_soranus_tmpb_str

\seq_new:N \l_soranus_tmpa_seq
\seq_new:N \l_soranus_tmpb_seq

\int_new:N \l_soranus_tmpa_int
\int_new:N \l_soranus_tmpb_int

\bool_new:N \l_soranus_tmpa_bool
\bool_new:N \l_soranus_tmpb_bool

\dim_new:N \l_soranus_tmpa_dim
\dim_new:N \l_soranus_tmpb_dim

\skip_new:N \l_soranus_tmpa_skip
\skip_new:N \l_soranus_tmpb_skip

\fp_new:N \l_soranus_tmpa_fp
\fp_new:N \l_soranus_tmpb_fp

\box_new:N \l_soranus_tmpa_box
\box_new:N \l_soranus_tmpb_box



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% General Utility Functions
%

% Function for applying a function to a comma pair.
\cs_new:Nn \soranus_apply_comma_pair:Nn
  {\__soranus_apply_comma_pair_aux:Nn #1 {#2}}

\cs_new:Nn \__soranus_apply_comma_pair_aux:Nn
  {
    \seq_set_from_clist:Nn \l_soranus_tmpa_seq {#2}
    \seq_pop:NN \l_soranus_tmpa_seq \l_soranus_tmpa_tl
    \seq_pop:NNTF \l_soranus_tmpa_seq \l_soranus_tmpb_tl
      {\exp_args:NVV #1 \l_soranus_tmpa_tl \l_soranus_tmpb_tl}
      {\exp_args:NVV #1 \l_soranus_tmpa_tl \l_soranus_tmpa_tl}
  }


% Function for scaling dimensions to nearest nth point. (avoid icky fp roundoff)
\cs_new:Nn \soranus_scale_to_nearest_nth_point:nnn
  {\fp_to_dim:n {round(#3 * #2 * \dim_to_fp:n {#1}) / #3}}

% User-friendly commands for rounded dimension scaling.

\NewDocumentCommand \ScaleToNearestPoint {m m}
  {\soranus_scale_to_nearest_nth_point:nnn {#1} {#2} {1}}

\NewDocumentCommand \ScaleToNearestHalfPoint {m m}
  {\soranus_scale_to_nearest_nth_point:nnn {#1} {#2} {2}}

\NewDocumentCommand \ScaleToNearestQuarterPoint {m m}
  {\soranus_scale_to_nearest_nth_point:nnn {#1} {#2} {4}}

\NewDocumentCommand \ScaleToNearestEighthPoint {m m}
  {\soranus_scale_to_nearest_nth_point:nnn {#1} {#2} {8}}

\NewDocumentCommand \ScaleToNearestTenthPoint {m m}
  {\soranus_scale_to_nearest_nth_point:nnn {#1} {#2} {10}}

\NewDocumentCommand \ScaleToNearestHundredthPoint {m m}
  {\soranus_scale_to_nearest_nth_point:nnn {#1} {#2} {100}}
